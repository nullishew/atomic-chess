var e=Object.defineProperty,t=(t,s,i)=>(((t,s,i)=>{s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[s]=i})(t,"symbol"!=typeof s?s+"":s,i),i);import{p as s}from"./phaser-C2_wa_Fb.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const i="chess-pieces",a="pixel-chess-sprites.png",o="chessboard-tiles",l="pixel-chess-tiles.png",r="particle",n="particle.png",c="explosion",h="explosion.wav",d="retry",u="retry.png",g="capture",m="chess-capture-indicator.png",p="move",b="chess-move-indicator.png",f={k:1,q:3,b:5,n:7,r:9,p:11,K:0,Q:2,B:4,N:6,R:8,P:10};class v extends s.GameObjects.Sprite{constructor(e,t,s,a){super(e,s,a,i,t),this.setOrigin(0)}move(e,t,s){this.scene.tweens.add({targets:this,x:e,y:t,ease:"quad.in",duration:s}).on("complete",(()=>this.setPosition(e,t)))}explode(){this.destroy()}promote(e){this.setFrame(f[e])}}var k=(e=>(e.WHITE="white",e.BLACK="black",e))(k||{}),P=(e=>(e.PROMOTION="promotion",e.DOUBLE="double",e.PAWN_MOVE="pawn move",e.CAPTURE="capture",e.DISABLE_BLACK_QUEENSIDE_CASTLING="disable black queenside castling",e.DISABLE_BLACK_KINGSIDE_CASTLING="disable black kingside castling",e.DISABLE_WHITE_QUEENSIDE_CASTLING="disable white queenside castling",e.DISABLE_WHITE_KINGSIDE_CASTLING="disable white kingside castling",e))(P||{}),T=(e=>(e.WHITE_WIN="w",e.BLACK_WIN="b",e.DRAW="d",e.STALEMATE="s",e))(T||{}),y=(e=>(e.CAPTURE="standard capture",e.EN_PASSANT="en passant",e.KINGSIDE_CASTLE="kingside castle",e.QUEENSIDE_CASTLE="queenside castle",e.STANDARD_MOVE="standard move",e))(y||{});const M={a1:0,b1:1,c1:2,d1:3,e1:4,f1:5,g1:6,h1:7,a2:16,b2:17,c2:18,d2:19,e2:20,f2:21,g2:22,h2:23,a3:32,b3:33,c3:34,d3:35,e3:36,f3:37,g3:38,h3:39,a4:48,b4:49,c4:50,d4:51,e4:52,f4:53,g4:54,h4:55,a5:64,b5:65,c5:66,d5:67,e5:68,f5:69,g5:70,h5:71,a6:80,b6:81,c6:82,d6:83,e6:84,f6:85,g6:86,h6:87,a7:96,b7:97,c7:98,d7:99,e7:100,f7:101,g7:102,h7:103,a8:112,b8:113,c8:114,d8:115,e8:116,f8:117,g8:118,h8:119},S={0:"a1",1:"b1",2:"c1",3:"d1",4:"e1",5:"f1",6:"g1",7:"h1",16:"a2",17:"b2",18:"c2",19:"d2",20:"e2",21:"f2",22:"g2",23:"h2",32:"a3",33:"b3",34:"c3",35:"d3",36:"e3",37:"f3",38:"g3",39:"h3",48:"a4",49:"b4",50:"c4",51:"d4",52:"e4",53:"f4",54:"g4",55:"h4",64:"a5",65:"b5",66:"c5",67:"d5",68:"e5",69:"f5",70:"g5",71:"h5",80:"a6",81:"b6",82:"c6",83:"d6",84:"e6",85:"f6",86:"g6",87:"h6",96:"a7",97:"b7",98:"c7",99:"d7",100:"e7",101:"f7",102:"g7",103:"h7",112:"a8",113:"b8",114:"c8",115:"d8",116:"e8",117:"f8",118:"g8",119:"h8"},C={white:"black",black:"white"},w={white:{second:1,last:7},black:{second:6,last:0}},q={white:"K",black:"k"},O={white:"R",black:"r"},I={white:"P",black:"p"},L={k:"black",q:"black",b:"black",n:"black",r:"black",p:"black",K:"white",Q:"white",B:"white",N:"white",R:"white",P:"white"},E={k:"K",q:"Q",b:"B",n:"N",r:"R",p:"P",K:"K",Q:"Q",B:"B",N:"N",R:"R",P:"P"},x={all:[-17,-16,-15,1,17,16,15,-1],cross:[-16,1,16,-1],l:[-18,-33,-31,-14,18,33,31,14],diagonal:[-17,-15,17,15]},A={k:x.all,q:x.all,b:x.diagonal,n:x.l,r:x.cross,p:[-16,-32],K:x.all,Q:x.all,B:x.diagonal,N:x.l,R:x.cross,P:[16,32]},G={k:[],q:x.all,b:x.diagonal,n:x.l,r:x.cross,p:[-17,-15],K:[],Q:x.all,B:x.diagonal,N:x.l,R:x.cross,P:[17,15]},N={k:!0,q:!1,b:!1,n:!0,r:!1,p:!0,K:!0,Q:!1,B:!1,N:!0,R:!1,P:!0},R={white:["K","Q","B","N","R","P"],black:["k","q","b","n","r","p"]},W={white:["Q","N","R","B"],black:["q","n","r","b"]},B={white:{"kingside castle":{kingMove:{from:M.e1,to:M.g1},rookMove:{from:M.h1,to:M.f1},between:[M.f1,M.g1]},"queenside castle":{kingMove:{from:M.e1,to:M.c1},rookMove:{from:M.a1,to:M.d1},between:[M.d1,M.c1,M.b1]}},black:{"kingside castle":{kingMove:{from:M.e8,to:M.g8},rookMove:{from:M.h8,to:M.f8},between:[M.f8,M.g8]},"queenside castle":{kingMove:{from:M.e8,to:M.c8},rookMove:{from:M.a8,to:M.d8},between:[M.d8,M.c8,M.b8]}}},F=["R","N","B","Q","K","B","N","R",null,null,null,null,null,null,null,null,"P","P","P","P","P","P","P","P",null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,"p","p","p","p","p","p","p","p",null,null,null,null,null,null,null,null,"r","n","b","q","k","b","n","r",null,null,null,null,null,null,null,null],K={activeColor:"white",board:F,hasCastlingRights:{white:{"kingside castle":!0,"queenside castle":!0},black:{"kingside castle":!0,"queenside castle":!0}},enPassantTarget:null,halfMoves:0,fullMoves:1};function U(e){return e>>4}function _(e){return 7&e}function D(e){return!(136&e)}function X(e,{from:t,to:s}){e[s]=e[t],e[t]=null}function Q(e,t){e[t]=null}function V(e,t){return x.all.map((e=>t+e)).filter((t=>{const s=e[t];return s&&"P"!=E[s]}))}function H(e,t){const s=e.indexOf(q[t]),i=e.indexOf(q[C[t]]);return-1!=s&&-1!=i&&!x.all.includes(s-i)&&Y(e,s,t)}function Y(e,t,s){return R[C[s]].some((s=>G[s].some((i=>{let a=t-i;for(;D(a);){const t=e[a];if(t)return t==s;if(N[s])return!1;a-=i}return!1}))))}class ${constructor(e){t(this,"board"),t(this,"activeColor"),t(this,"hasCastlingRights"),t(this,"enPassantSquare"),t(this,"halfMoves"),t(this,"fullMoves"),t(this,"history",[]),t(this,"positionCount",{}),this.load(e)}getPositionFEN(){let e="";for(let t=7;t>=0;t--){let s=0;for(let i=0;i<8;i++){const a=16*t+i;this.board[a]?(s>0&&(e+=s,s=0),e+=this.board[a]):s++}if(s>0&&(e+=s),0==t)break;e+="/"}return e}getFEN(){const e=this.getPositionFEN(),t="white"==this.activeColor?"w":"b";let s="";return this.hasCastlingRights.white["kingside castle"]&&(s+="K"),this.hasCastlingRights.white["queenside castle"]&&(s+="Q"),this.hasCastlingRights.black["kingside castle"]&&(s+="k"),this.hasCastlingRights.black["queenside castle"]&&(s+="q"),""==s&&(s="-"),`${e} ${t} ${s} ${this.enPassantSquare?S[this.enPassantSquare]+" ":""}${this.halfMoves} ${this.fullMoves}`}load(e){Object.assign(this,e),this.addPositionToHistory()}addPositionToHistory(){const e=this.getPositionFEN();this.history.push(e),this.positionCount[e]=(this.positionCount[e]??0)+1}hasLegalMoves(){return Object.keys(M).some((e=>this.getLegalMovesFrom(e).length>0))}isWin(e){return this.isCheckmate(C[e])||-1==this.board.indexOf(q[C[e]])}isCheckmate(e){return H(this.board,e)&&!this.hasLegalMoves()}isStalemate(){return!H(this.board,this.activeColor)&&!this.hasLegalMoves()&&this.board.indexOf(q[this.activeColor])>-1}isDraw(){return this.isFiftyMoveDraw()||this.isThreeFoldRepetition()}isThreeFoldRepetition(){return(this.positionCount[this.getPositionFEN()]??0)>=3}isFiftyMoveDraw(){return this.halfMoves>=50}promote(e,t){this.board[M[e]]=t}switchTurn(){this.halfMoves++,"black"==this.activeColor&&this.fullMoves++,this.activeColor=C[this.activeColor],this.enPassantSquare=null}updateFlags({enPassantSquare:e,flags:t}){var s,i,a,o;t&&((t["pawn move"]||t.capture)&&(this.halfMoves=0),t.double&&e&&(this.enPassantSquare=e),(s=this.hasCastlingRights.black)["kingside castle"]&&(s["kingside castle"]=!t["disable black kingside castling"]),(i=this.hasCastlingRights.black)["queenside castle"]&&(i["queenside castle"]=!t["disable black queenside castling"]),(a=this.hasCastlingRights.white)["kingside castle"]&&(a["kingside castle"]=!t["disable white kingside castling"]),(o=this.hasCastlingRights.white)["queenside castle"]&&(o["queenside castle"]=!t["disable white queenside castling"]))}tryMove({from:e,to:t}){const s=this.getLegalMovesFrom(e).find((e=>e.to==M[t]));return s?(this.switchTurn(),this.updateFlags(s),this.board=s.result,this.addPositionToHistory(),s):null}tryGameOver(){return this.isDraw()?"d":this.isStalemate()?"s":this.isWin("white")?"w":this.isWin("black")?"b":null}getLegalMovesFrom(e){const t=M[e];return[...this.getCastlesFrom("kingside castle",t),...this.getCastlesFrom("queenside castle",t),...this.getPawnCapturesFrom(t),...this.getPawnMovesFrom(t),...this.getStandardMovesFrom(t)].filter((({result:e,color:t})=>e.indexOf(q[t])>-1&&!H(e,t)))}getStandardMovesFrom(e){const t=this.board[e];if(!t||L[t]!=this.activeColor)return[];if("P"==E[t])return[];const s=A[t],i=[];for(const a of s){let s=e+a;for(;D(s)&&!this.board[s]&&(i.push(j({board:this.board,from:e,to:s,piece:t,color:this.activeColor,type:"standard move"})),!N[t]);)s+=a;if("K"==E[t])continue;const o=this.board[s];o&&L[o]==C[this.activeColor]&&i.push(j({board:this.board,from:e,to:s,piece:t,color:this.activeColor,type:"standard capture"}))}return i}getPawnCapturesFrom(e){const t=this.board[e];if(t!=I[this.activeColor])return[];const s=G[t].map((t=>e+t)),i=s.filter((e=>{const t=this.board[e];return t&&L[t]==C[this.activeColor]})).map((s=>j({board:this.board,from:e,to:s,piece:t,color:this.activeColor,type:"standard capture"})));if(!this.enPassantSquare||!s.includes(this.enPassantSquare))return i;const a=j({board:this.board,from:e,to:this.enPassantSquare,piece:t,color:this.activeColor,type:"en passant"});return[...i,a]}getPawnMovesFrom(e){const t=this.board[e];if(t!=I[this.activeColor])return[];const[s,i]=A[t].map((t=>e+t));if(!s||this.board[s])return[];const a=j({board:this.board,from:e,to:s,color:this.activeColor,piece:t,type:"standard move"});return!i||this.board[i]||U(e)!=w[this.activeColor].second?[a]:[a,j({board:this.board,from:e,to:i,color:this.activeColor,piece:t,type:"standard move",flags:{double:!0},enPassantSquare:s})]}getCastlesFrom(e,t){const{kingMove:s,between:i,rookMove:a}=B[this.activeColor][e];if(!this.hasCastlingRights[this.activeColor][e]||t!=s.from)return[];const o=this.board[s.from];return o!=q[this.activeColor]||this.board[a.from]!=O[this.activeColor]||H(this.board,this.activeColor)||i.some((e=>this.board[e]||Y(this.board,e,this.activeColor)))?[]:[j({board:this.board,from:t,to:s.to,piece:o,color:this.activeColor,type:e})]}}function j({board:e,from:t,to:s,color:i,piece:a,type:o,flags:l,enPassantSquare:r}){const n=structuredClone(e);let c=[],h=!1;switch(l??(l={}),o){case"kingside castle":case"queenside castle":const{kingMove:d,rookMove:u}=B[i][o];return X(n,d),X(n,u),l["disable black kingside castling"]="black"==i,l["disable black queenside castling"]="black"==i,l["disable white kingside castling"]="white"==i,l["disable white queenside castling"]="white"==i,{from:t,to:s,color:i,piece:a,type:o,flags:l,result:n};case"standard move":return X(n,{from:t,to:s}),l["pawn move"]="P"==E[a],l.promotion=function(e,t){const s=e[t];return!(!s||"P"!=E[s])&&U(t)==w[L[s]].last}(n,s),l["disable black kingside castling"]="k"==a||"r"==a&&t==B.black["kingside castle"].rookMove.from,l["disable black queenside castling"]="k"==a||"r"==a&&t==B.black["queenside castle"].rookMove.from,l["disable white kingside castling"]="K"==a||"R"==a&&t==B.white["kingside castle"].rookMove.from,l["disable white queenside castling"]="K"==a||"R"==a&&t==B.white["queenside castle"].rookMove.from,{from:t,to:s,color:i,piece:a,type:o,flags:l,enPassantSquare:r,result:n};case"standard capture":case"en passant":const g="standard capture"==o?s:s-A[a][0];return Q(n,t),c=[g,...V(n,s)],c.forEach((e=>Q(n,e))),l.capture=!0,l["disable black kingside castling"]=c.some((s=>"r"==e[s]&&t==B.black["kingside castle"].rookMove.from)),l["disable black queenside castling"]=c.some((s=>"r"==e[s]&&t==B.black["queenside castle"].rookMove.from)),l["disable white kingside castling"]=c.some((s=>"R"==e[s]&&t==B.white["kingside castle"].rookMove.from)),l["disable white queenside castling"]=c.some((s=>"R"==e[s]&&t==B.white["queenside castle"].rookMove.from)),h=!0,{from:t,to:s,color:i,piece:a,type:o,flags:l,result:n,captures:c,explode:h}}return{from:t,to:s,color:i,piece:a,type:o,flags:l,enPassantSquare:r,result:n,captures:c,explode:h}}class z{constructor({scene:e,tileSize:s,pieceMoveTime:a,gameOverMenuCallback:o}){t(this,"scene"),t(this,"chessboard"),t(this,"chessboardTileLayer"),t(this,"moveIndicatorLayer"),t(this,"captureIndicatorLayer"),t(this,"chessboardOutline"),t(this,"chessPieces"),t(this,"pointerTileOutline"),t(this,"selectedTileOutline"),t(this,"explosionParticles"),t(this,"explosionSound"),t(this,"pieceMoveTime"),t(this,"promotionMenus"),t(this,"gameOverMenus"),t(this,"explodePiece",(e=>{const t=this.chessPieces[e];t&&(this.chessPieces[e]=null,this.scene.time.addEvent({delay:this.pieceMoveTime,callback:()=>{const{x:e,y:s}=t;t.explode(),this.explosionParticles.explode(50,e,s),this.scene.cameras.main.shake(500,.01),this.explosionSound.play()}}))})),this.scene=e,this.pieceMoveTime=a,e.cameras.main.centerOn(0,0),this.createsChessboard(s),this.createChessPieces(F);const l=e.add.container(0,0,this.chessPieces.flatMap((e=>e??[])));this.createMoveIndicators(),this.pointerTileOutline=this.addTileOutline(s),this.selectedTileOutline=this.addTileOutline(s),this.explosionParticles=e.add.particles(0,0,r,{speed:{min:300,max:600},scale:{start:.6,end:0,random:!0},alpha:{start:1,end:0},lifespan:{min:300,max:600},emitting:!1}),this.explosionSound=e.sound.add(c),this.gameOverMenus={[T.WHITE_WIN]:this.createGameOverMenu("Winner:",[e.add.image(0,0,i,0).setScale(2)],o).setVisible(!1).setAlpha(0),[T.BLACK_WIN]:this.createGameOverMenu("Winner:",[e.add.image(0,0,i,1).setScale(2)],o).setVisible(!1).setAlpha(0),[T.DRAW]:this.createGameOverMenu("Draw",[],o).setVisible(!1).setAlpha(0),[T.STALEMATE]:this.createGameOverMenu("Stalemate",[],o).setVisible(!1).setAlpha(0)},e.add.layer([this.chessboardOutline,this.chessboardTileLayer,l,this.pointerTileOutline,this.selectedTileOutline,this.moveIndicatorLayer,this.captureIndicatorLayer,this.explosionParticles,this.gameOverMenus[T.WHITE_WIN],this.gameOverMenus[T.BLACK_WIN],this.gameOverMenus[T.DRAW],this.gameOverMenus[T.STALEMATE]])}createsChessboard(e){this.chessboard=this.scene.make.tilemap({data:[[0,1,0,1,0,1,0,1],[1,0,1,0,1,0,1,0],[0,1,0,1,0,1,0,1],[1,0,1,0,1,0,1,0],[0,1,0,1,0,1,0,1],[1,0,1,0,1,0,1,0],[0,1,0,1,0,1,0,1],[1,0,1,0,1,0,1,0]],tileWidth:e,tileHeight:e});const t=this.chessboard.addTilesetImage(o);this.chessboardTileLayer=this.chessboard.createLayer(0,t,-4*e,-4*e);const{width:s,height:i}=this.chessboardTileLayer,a=.25*e;this.chessboardOutline=this.scene.add.rectangle(0,0,s+a,i+a,2434341),this.chessboardOutline.postFX.addGlow(16777215,.125*e,0,!1,1,.375*e)}createMoveIndicators(){const{x:e,y:t}=this.chessboardTileLayer.getTopLeft(),s=this.chessboard.addTilesetImage(g);this.captureIndicatorLayer=this.chessboard.createBlankLayer("Capture Indicators",s,e,t).fill(0,0,0,8,8);const i=this.chessboard.addTilesetImage(p);this.moveIndicatorLayer=this.chessboard.createBlankLayer("Move Indicators",i,e,t).fill(0,0,0,8,8),this.indicateValidMoves({})}createChessPieces(e){this.chessPieces=e.map(((e,t)=>{if(!e)return null;const{x:s,y:i}=this.squareToWorldXY(S[t]);return this.scene.add.existing(new v(this.scene,f[e],s,i))}))}addTileOutline(e){return this.scene.add.rectangle(0,0,e,e).setStrokeStyle(.125*e,16777215,1).setOrigin(0).setVisible(!1)}createPromotionMenu(e,t,s){const a=this.scene,{x:o,y:l}=this.squareToWorldXY(t),r=this.chessboard.tileHeight,n=a.add.container(o,l+(e==k.BLACK?-3*r:0)),c=a.add.rectangle(0,0,r,4*r,16777215,1).setOrigin(0).setStrokeStyle(2,0,.5),h=W[e];e==k.BLACK&&h.reverse();const d=h.map(((e,t)=>a.add.image(0,t*r,i,f[e]).setOrigin(0).setInteractive({useHandCursor:!0}).once("pointerdown",(()=>{s(e),n.destroy()}))));return n.add(c).add(d)}createGameOverMenu(e,t,s){const i=this.scene,a=i.add.container(0,0),o=i.add.graphics().fillStyle(268435455,.5).fillRect(-64,-64,128,128),l=i.add.text(0,-32,e,{color:"black",fontFamily:"Super Dream",fontSize:24}).setResolution(48).setStroke("rgba(255, 255, 255, .5)",2).setOrigin(.5),r=i.add.image(0,32,d).setOrigin(.5).setInteractive({useHandCursor:!0}).once("pointerdown",s);return a.add([o,l,...t,r])}highlightSquare(e,t){if(!t)return void(e.visible=!1);const{x:s,y:i}=this.squareToWorldXY(t);e.setPosition(s,i).setVisible(!0)}indicateValidMoves({captures:e,moves:t}){[this.captureIndicatorLayer,this.moveIndicatorLayer].flatMap((e=>e.getTilesWithin(0,0,8,8))).forEach((e=>null==e?void 0:e.setVisible(!1))),null==e||e.forEach((e=>{var t;const{x:s,y:i}=this.x88ToTileXY(e);null==(t=this.captureIndicatorLayer.getTileAt(s,i))||t.setVisible(!0)})),null==t||t.forEach((e=>{var t;const{x:s,y:i}=this.x88ToTileXY(e);null==(t=this.moveIndicatorLayer.getTileAt(s,i))||t.setVisible(!0)}))}movePiece({from:e,to:t}){var s;const{x:i,y:a}=this.squareToWorldXY(S[t]);null==(s=this.chessPieces[e])||s.move(i,a,this.pieceMoveTime),this.chessPieces[t]=this.chessPieces[e],this.chessPieces[e]=null}update({color:e,type:t,captures:s,explode:i,from:a,to:o}){null==s||s.forEach(this.explodePiece),this.movePiece({from:a,to:o}),t!=y.KINGSIDE_CASTLE&&t!=y.QUEENSIDE_CASTLE||this.movePiece(B[e][t].rookMove),i&&this.explodePiece(o)}showGameOverMenu(e){this.scene.tweens.add({targets:this.gameOverMenus[e].setVisible(!0),duration:1e3,delay:1e3,alpha:{from:0,to:1},ease:"sine.in"})}promoteSprite(e,t){var s;null==(s=this.chessPieces[M[e]])||s.promote(t)}tileXYToX88(e,t){return 16*(7-t)+e}x88ToTileXY(e){return{x:_(e),y:7-U(e)}}squareToWorldXY(e){const{x:t,y:s}=this.x88ToTileXY(M[e]);return this.chessboardTileLayer.tileToWorldXY(t,s)}worldXYToSquare(e,t){const{x:s,y:i}=this.chessboardTileLayer.worldToTileXY(e,t);return S[this.tileXYToX88(s,i)]}}class J extends s.Scene{constructor(){super("Game"),t(this,"chessLogic"),t(this,"chessGUI"),t(this,"selectedSquare"),t(this,"pointerSquare"),t(this,"isGameOver"),t(this,"isPromoting")}create(){this.cameras.main.fadeIn(3e3,0,0,0),this.isGameOver=!1,this.isPromoting=!1,this.chessLogic=new $(structuredClone(K)),this.chessGUI=new z({scene:this,tileSize:te,pieceMoveTime:100,gameOverMenuCallback:()=>{this.cameras.main.fadeOut(1e3,0,0,0),this.time.addEvent({delay:1e3,callback:()=>this.scene.restart()})}});const e=()=>{const{x:e,y:t}=this.input.activePointer.positionToCamera(this.cameras.main);this.pointerSquare=this.chessGUI.worldXYToSquare(e,t)};this.input.on("pointermove",(()=>{this.isGameOver||this.isPromoting||(e(),this.chessGUI.highlightSquare(this.chessGUI.pointerTileOutline,this.pointerSquare))})),this.input.on("pointerdown",(()=>{if(this.isGameOver||this.isPromoting)return;e();const{pointerSquare:t}=this;if(!t)return void this.deselectSquare();const{activeColor:s,board:i}=this.chessLogic,a=i[M[t]];a&&L[a]==s?this.selectSquare(t):this.selectedSquare&&(this.tryMove({from:this.selectedSquare,to:t}),this.deselectSquare())}))}tryMove(e){const{to:t}=e,{activeColor:s}=this.chessLogic,i=this.chessLogic.tryMove(e);if(!i)return;this.chessGUI.update(i);const{flags:a}=i;if(console.table(i),null==a?void 0:a[P.PROMOTION])return this.isPromoting=!0,void this.chessGUI.createPromotionMenu(s,t,(e=>{this.chessLogic.promote(t,e),this.chessGUI.promoteSprite(t,e),this.isPromoting=!1,this.tryGameOver()}));this.tryGameOver()}tryGameOver(){const e=this.chessLogic.tryGameOver();e&&(this.isGameOver=!0,this.chessGUI.showGameOverMenu(e))}selectSquare(e){this.selectedSquare=e,this.chessGUI.highlightSquare(this.chessGUI.selectedTileOutline,e);const t=this.chessLogic.getLegalMovesFrom(e);this.chessGUI.indicateValidMoves({captures:t.filter((({type:e})=>e==y.CAPTURE)).map((({to:e})=>e)),moves:t.filter((({type:e})=>e!=y.CAPTURE)).map((({to:e})=>e))})}deselectSquare(){this.selectedSquare=null,this.chessGUI.highlightSquare(this.chessGUI.selectedTileOutline,null),this.chessGUI.highlightSquare(this.chessGUI.pointerTileOutline,null),this.chessGUI.indicateValidMoves({})}}class Z extends s.Scene{constructor(){super("Preloader")}init(){const{config:e}=this.game,t=Number(e.width),s=Number(e.height),i=.5*t,a=.5*s;this.add.rectangle(i,a,i,16).setStrokeStyle(2,16777215);const o=this.add.rectangle(i-.5*i,a,0,16,16777215);this.load.on("progress",(e=>o.width=i*e))}preload(){this.load.setPath("assets"),this.load.audio(c,h),this.load.image(o,l),this.load.image(g,m),this.load.image(p,b),this.load.image(d,u),this.load.image(r,n),this.load.spritesheet(i,a,{frameWidth:te,frameHeight:te})}create(){this.scene.start("Game")}}const ee={type:Phaser.AUTO,width:160,height:160,parent:"game-container",backgroundColor:"#000000",scale:{mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH},pixelArt:!0,scene:[Z,J]};new s.Game(ee);const te=16;
