var e=Object.defineProperty,t=(t,s,i)=>(((t,s,i)=>{s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[s]=i})(t,"symbol"!=typeof s?s+"":s,i),i);import{p as s}from"./phaser-C2_wa_Fb.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const i="chess-pieces",o="pixel-chess-sprites.png",n="chessboard-tiles",r="pixel-chess-tiles.png",a="particle",c="particle.png",l="explosion",h="explosion.wav",d="retry",u="retry.png",p={k:1,q:3,b:5,n:7,r:9,p:11,K:0,Q:2,B:4,N:6,R:8,P:10};var f=(e=>(e.WHITE="white",e.BLACK="black",e))(f||{}),m=(e=>(e.CAPTURE="standard capture",e.DOUBLE="pawn double move",e.EN_PASSANT="en passant",e.KINGSIDE_CASTLE="kingside castle",e.PROMOTION="promotion",e.QUEENSIDE_CASTLE="queenside castle",e.STANDARD_MOVE="standard move",e))(m||{}),b=(e=>(e.KINGSIDE="kingside",e.QUEENSIDE="queenside",e))(b||{}),g=(e=>(e.WHITE_WIN="w",e.BLACK_WIN="b",e.DRAW="d",e.STALEMATE="s",e))(g||{}),v=(e=>(e.KING="K",e.QUEEN="Q",e.BISHOP="B",e.KNIGHT="N",e.ROOK="R",e.PAWN="P",e))(v||{});const I={k:"black",q:"black",b:"black",n:"black",r:"black",p:"black",K:"white",Q:"white",B:"white",N:"white",R:"white",P:"white"},S={k:"K",q:"Q",b:"B",n:"N",r:"R",p:"P",K:"K",Q:"Q",B:"B",N:"N",R:"R",P:"P"},E={a8:[7,0],b8:[7,1],c8:[7,2],d8:[7,3],e8:[7,4],f8:[7,5],g8:[7,6],h8:[7,7],a7:[6,0],b7:[6,1],c7:[6,2],d7:[6,3],e7:[6,4],f7:[6,5],g7:[6,6],h7:[6,7],a6:[5,0],b6:[5,1],c6:[5,2],d6:[5,3],e6:[5,4],f6:[5,5],g6:[5,6],h6:[5,7],a5:[4,0],b5:[4,1],c5:[4,2],d5:[4,3],e5:[4,4],f5:[4,5],g5:[4,6],h5:[4,7],a4:[3,0],b4:[3,1],c4:[3,2],d4:[3,3],e4:[3,4],f4:[3,5],g4:[3,6],h4:[3,7],a3:[2,0],b3:[2,1],c3:[2,2],d3:[2,3],e3:[2,4],f3:[2,5],g3:[2,6],h3:[2,7],a2:[1,0],b2:[1,1],c2:[1,2],d2:[1,3],e2:[1,4],f2:[1,5],g2:[1,6],h2:[1,7],a1:[0,0],b1:[0,1],c1:[0,2],d1:[0,3],e1:[0,4],f1:[0,5],g1:[0,6],h1:[0,7]},L={ALL:[[0,1],[0,-1],[1,0],[-1,0],[1,1],[-1,1],[-1,-1],[1,-1]],DIAGONAL:[[1,1],[-1,1],[-1,-1],[1,-1]],HORIZONTAL:[[0,1],[0,-1]],L_SHAPE:[[1,2],[2,1],[2,-1],[1,-2],[-1,-2],[-2,-1],[-2,1],[-1,2]],PLUS_SHAPE:[[0,1],[0,-1],[1,0],[-1,0]],VERTICAL:[[1,0],[-1,0]]},A={K:{steps:1,patterns:L.ALL},Q:{steps:7,patterns:L.ALL},B:{steps:7,patterns:L.DIAGONAL},N:{steps:1,patterns:L.L_SHAPE},R:{steps:7,patterns:L.PLUS_SHAPE},P:{steps:1,patterns:[[1,0]]},k:{steps:1,patterns:L.ALL},q:{steps:7,patterns:L.ALL},b:{steps:7,patterns:L.DIAGONAL},n:{steps:1,patterns:L.L_SHAPE},r:{steps:7,patterns:L.PLUS_SHAPE},p:{steps:1,patterns:[[-1,0]]}},T={K:{steps:0,patterns:L.ALL},Q:{steps:7,patterns:L.ALL},B:{steps:7,patterns:L.DIAGONAL},N:{steps:1,patterns:L.L_SHAPE},R:{steps:7,patterns:L.PLUS_SHAPE},P:{steps:1,patterns:[[1,-1],[1,1]]},k:{steps:0,patterns:L.ALL},q:{steps:7,patterns:L.ALL},b:{steps:7,patterns:L.DIAGONAL},n:{steps:1,patterns:L.L_SHAPE},r:{steps:7,patterns:L.PLUS_SHAPE},p:{steps:1,patterns:[[-1,-1],[-1,1]]}},P={white:{kingside:{kingMove:{from:"e1",to:"g1"},rookMove:{from:"h1",to:"f1"},between:["f1","g1"]},queenside:{kingMove:{from:"e1",to:"c1"},rookMove:{from:"a1",to:"d1"},between:["d1","c1","b1"]}},black:{kingside:{kingMove:{from:"e8",to:"g8"},rookMove:{from:"h8",to:"f8"},between:["f8","g8"]},queenside:{kingMove:{from:"e8",to:"c8"},rookMove:{from:"a8",to:"d8"},between:["d8","c8","b8"]}}},N={white:["a8","b8","c8","d8","e8","f8","g8","h8"],black:["a1","b1","c1","d1","e1","f1","g1","h1"]},y={white:{a2:{from:"a2",between:"a3",to:"a4"},b2:{from:"b2",between:"b3",to:"b4"},c2:{from:"c2",between:"c3",to:"c4"},d2:{from:"d2",between:"d3",to:"d4"},e2:{from:"e2",between:"e3",to:"e4"},f2:{from:"f2",between:"f3",to:"f4"},g2:{from:"g2",between:"g3",to:"g4"},h2:{from:"h2",between:"h3",to:"h4"}},black:{a7:{from:"a7",between:"a6",to:"a5"},b7:{from:"b7",between:"b6",to:"b5"},c7:{from:"c7",between:"c6",to:"c5"},d7:{from:"d7",between:"d6",to:"d5"},e7:{from:"e7",between:"e6",to:"e5"},f7:{from:"f7",between:"f6",to:"f5"},g7:{from:"g7",between:"g6",to:"g5"},h7:{from:"h7",between:"h6",to:"h5"}}},M={a8:"r",b8:"n",c8:"b",d8:"q",e8:"k",f8:"b",g8:"n",h8:"r",a7:"p",b7:"p",c7:"p",d7:"p",e7:"p",f7:"p",g7:"p",h7:"p",a6:null,b6:null,c6:null,d6:null,e6:null,f6:null,g6:null,h6:null,a5:null,b5:null,c5:null,d5:null,e5:null,f5:null,g5:null,h5:null,a4:null,b4:null,c4:null,d4:null,e4:null,f4:null,g4:null,h4:null,a3:null,b3:null,c3:null,d3:null,e3:null,f3:null,g3:null,h3:null,a2:"P",b2:"P",c2:"P",d2:"P",e2:"P",f2:"P",g2:"P",h2:"P",a1:"R",b1:"N",c1:"B",d1:"Q",e1:"K",f1:"B",g1:"N",h1:"R"},w={activeColor:"white",board:M,hasCastlingRights:{white:{kingside:!0,queenside:!0},black:{kingside:!0,queenside:!0}},enPassantTargets:[],halfMoves:0,fullMoves:0},O=Object.keys(E);function C(e){return"white"==e?"black":"white"}function k(e){const[t,s]=e;return t<0||t>7||s<0||s>7?null:G(e)}function G([e,t]){return"abcdefgh"[t]+"12345678"[e]}function q(e,[t,s],i=1){const[o,n]=E[e];return k([o+i*t,n+i*s])}class x extends s.GameObjects.Sprite{constructor(e,t,s,o){super(e,s,o,i,t),this.setOrigin(0)}move(e,t,s,i){this.scene.tweens.add({targets:this,x:e,y:t,ease:"quad.in",duration:i}).on("complete",(()=>{this.setPosition(e,t),s&&this.destroy()}))}promote(e){this.setFrame(p[e])}}class D{constructor(e,s,i){t(this,"scene"),t(this,"chessboardTilemap"),t(this,"chessboardTilemapLayer"),t(this,"sprites"),t(this,"pointerTileIndicator"),t(this,"selectedTileIndicator"),t(this,"moveIndicators"),t(this,"captureIndicators"),t(this,"explosionSound"),t(this,"explosionParticles"),t(this,"pieceMoveTime"),this.scene=e,this.pieceMoveTime=i,e.cameras.main.centerOn(0,0),({map:this.chessboardTilemap,layer:this.chessboardTilemapLayer}=function(e,t){const s=e.make.tilemap({data:[[0,1,0,1,0,1,0,1],[1,0,1,0,1,0,1,0],[0,1,0,1,0,1,0,1],[1,0,1,0,1,0,1,0],[0,1,0,1,0,1,0,1],[1,0,1,0,1,0,1,0],[0,1,0,1,0,1,0,1],[1,0,1,0,1,0,1,0]],tileWidth:t,tileHeight:t}),i=s.addTilesetImage(n),o=s.createLayer(0,i,0,0),{x:r,y:a}=o.getBottomRight();return o.setPosition(-.5*r,-.5*a),{map:s,layer:o}}(this.scene,s));const o=this.scene.add.container();this.sprites=function(e,t,s,i){const o={};for(const n of O){const r=i[n];if(!r){o[n]=null;continue}const{x:a,y:c}=ae(n,t),l=W(e,r,a,c);o[n]=l,s.add(l)}return o}(e,this.chessboardTilemapLayer,o,structuredClone(M));const r=this.scene.add.container();this.pointerTileIndicator=R(this.scene,s,.1*s,16777215,1).setVisible(!1),this.selectedTileIndicator=R(this.scene,s,.1*s,16777215,1).setVisible(!1),r.add([this.pointerTileIndicator,this.selectedTileIndicator]);const c=this.scene.add.container();this.captureIndicators={},this.moveIndicators={};for(const t of O){let{x:e,y:i}=ae(t,this.chessboardTilemapLayer);e+=.5*s,i+=.5*s,this.captureIndicators[t]=U(this.scene,e,i,.125*s,.4375*s),this.moveIndicators[t]=K(this.scene,e,i,.125*s),c.add([this.captureIndicators[t].setVisible(!1),this.moveIndicators[t].setVisible(!1)])}this.explosionParticles=this.scene.add.particles(0,0,a,{speed:{min:300,max:600},scale:{start:.6,end:0,random:!0},alpha:{start:1,end:0},lifespan:{min:300,max:600},emitting:!1}),this.explosionSound=this.scene.sound.add(l)}explode(e,t){this.explosionParticles.explode(50,e,t),this.scene.cameras.main.shake(500,.01),this.explosionSound.play()}highlightSquare(e){if(!e)return void(this.pointerTileIndicator.visible=!1);const{x:t,y:s}=ae(e,this.chessboardTilemapLayer);this.pointerTileIndicator.setPosition(t,s).setVisible(!0)}selectSquare(e){const{x:t,y:s}=ae(e,this.chessboardTilemapLayer);this.selectedTileIndicator.setPosition(t,s).setVisible(!0)}deselectSquare(){this.selectedTileIndicator.visible=!1}indicateMovableSquares(e){e.forEach((e=>this.moveIndicators[e].visible=!0))}indicateCapturableSquares(e){e.forEach((e=>this.captureIndicators[e].visible=!0))}hideActionIndicators(){for(const e of O)this.captureIndicators[e].visible=!1,this.moveIndicators[e].visible=!1}update({actions:e}){for(const{move:{from:t,to:s},explode:i}of e){const e=this.sprites[t];if(!e)continue;const{x:o,y:n}=ae(s,this.chessboardTilemapLayer);e.move(o,n,i,this.pieceMoveTime),i&&this.scene.time.addEvent({delay:this.pieceMoveTime,callback:()=>this.explode(o,n)})}for(const{move:{from:t,to:s},explode:i}of e)s!=t&&(this.sprites[s]=this.sprites[t],this.sprites[t]=null),i&&(this.sprites[s]=null)}promoteSprite(e,t){var s;null==(s=this.sprites[e])||s.promote(t)}}function R(e,t,s,i,o){return e.add.graphics().lineStyle(s,i,o).strokeRect(0,0,t,t)}function K(e,t,s,i){return e.add.graphics().fillStyle(0,.3).fillCircle(t,s,i).setActive(!1)}function U(e,t,s,i,o){return e.add.graphics().lineStyle(i,0,.3).strokeCircle(t,s,o).setActive(!1)}function W(e,t,s,i){return e.add.existing(new x(e,p[t],s,i))}function H(e,t){return function(e,t){return O.find((s=>e[s]==t))??null}(e,t==f.WHITE?"K":"k")}function B(e,t){let s=structuredClone(e);return F(s,t),{result:s,moveType:J(s,t.to)?m.PROMOTION:m.STANDARD_MOVE,actions:[{move:t,explode:!1}]}}function _(e,t){let s=structuredClone(e);return F(s,t),{result:s,moveType:m.DOUBLE,actions:[{move:t,explode:!1}]}}function Q(e,t){let s=structuredClone(e);const{to:i}=t;F(s,t);const o=Y(s,i);return o.forEach((e=>X(s,e))),X(s,i),{result:s,moveType:m.CAPTURE,actions:[{move:t,explode:!0},{move:{from:i,to:i},explode:!0},...o.map((e=>({move:{from:e,to:e},explode:!0})))]}}function V(e,t){let s=structuredClone(e);const{from:i,to:o}=t,n=G([E[i][0],E[o][1]]);F(s,t),X(s,n);const r=Y(s,o);return r.forEach((e=>X(s,e))),X(s,o),{result:s,moveType:m.EN_PASSANT,actions:[{move:t,explode:!0},{move:{from:n,to:n},explode:!0},...r.map((e=>({move:{from:e,to:e},explode:!0})))]}}function j(e,t,s){let i=structuredClone(e);const{kingMove:o,rookMove:n}=P[t][s];return F(i,o),F(i,n),{result:i,moveType:s==b.KINGSIDE?m.KINGSIDE_CASTLE:m.QUEENSIDE_CASTLE,actions:[{move:o,explode:!1},{move:n,explode:!1}]}}function F(e,t){const{from:s,to:i}=t;e[i]=e[s],e[s]=null}function X(e,t){e[t]=null}function Y(e,t){let s=[];const[i,o]=E[t];for(let n=-1;n<=1;n++)for(let t=-1;t<=1;t++){if(0==n&&0==t)continue;const r=k([i+n,o+t]);if(!r)continue;const a=e[r];a&&S[a]!=v.PAWN&&s.push(r)}return s}function $(e,t){const s=C(t),i=H(e,t),o=H(e,s);if(!i||!o)return!1;if(function(e,t){const[s,i]=E[e],[o,n]=E[t];return Math.abs(s-o)<=1&&Math.abs(i-n)<=1}(i,o))return!1;for(let[n,r]of Object.entries(I)){if(t==r)continue;const{patterns:o,steps:a}=T[n];for(let t of o)for(let o=1;o<=a;o++){const r=q(i,t,-o);if(!r)break;const a=e[r];if(a){if(I[a]!=s||S[a]!=S[n])break;return!0}}}return!1}function z(e,t){return null!=H(e,t)&&!$(e,t)}function Z(e){return O.flatMap((t=>function(e,t){return[...oe(e,b.KINGSIDE,t),...oe(e,b.QUEENSIDE,t),...se(e,t),...ie(e,t),...ee(e,t),...te(e,t)]}(e,t).map((e=>({from:t,to:e})))))}function J(e,t){const s=e[t];return!(!s||S[s]!=v.PAWN)&&N[I[s]].includes(t)}function ee(e,t){const{board:s,activeColor:i}=e,o=s[t];if(!o||I[o]!=i)return[];const{patterns:n,steps:r}=T[o],a=C(i);return n.flatMap((e=>{for(let i=1;i<=r;i++){const o=q(t,e,i);if(!o)return[];const n=s[o];if(n)return I[n]==a?[o]:[]}return[]})).filter((e=>z(Q(s,{from:t,to:e}).result,i)))}function te(e,t){const{board:s,activeColor:i}=e,o=s[t];if(!o||I[o]!=i)return[];const{patterns:n,steps:r}=A[o];return n.flatMap((e=>{const i=[];for(let o=1;o<=r;o++){const n=q(t,e,o);if(!n||s[n])return i;i.push(n)}return i})).filter((e=>z(B(s,{from:t,to:e}).result,i)))}function se({board:e,activeColor:t},s){const i=e[s];if(!i||S[i]!=v.PAWN||I[i]!=t)return[];if(!(s in y[t]))return[];const{between:o,to:n}=y[t][s];return e[o]||e[n]?[]:z(_(e,{from:s,to:n}).result,t)?[n]:[]}function ie({board:e,activeColor:t,enPassantTargets:s},i){const o=e[i];return o&&S[o]==v.PAWN&&I[o]==t?T[o].patterns.flatMap((e=>q(i,e)??[])).filter((o=>s.includes(o)&&z(V(e,{from:i,to:o}).result,t))):[]}function oe(e,t,s){const{board:i,activeColor:o,hasCastlingRights:n}=e;if(!n[o][t]||$(i,o))return[];const{kingMove:r,between:a,rookMove:c}=P[o][t];if(s!=r.from)return[];const l=i[r.from],h=i[c.from];return l&&S[l]==v.KING&&I[l]==o&&h&&S[h]==v.ROOK&&I[h]==o?a.some((e=>i[e]))?[]:z(j(i,o,t).result,o)?[r.to]:[]:[]}class ne{constructor(e){t(this,"data"),this.data=e}tryMove(e){const{data:t}=this,{board:s,activeColor:i}=t,{from:o,to:n}=e;return se(t,o).includes(n)?this.update(_(s,e)):ie(t,o).includes(n)?this.update(V(s,e)):oe(t,b.KINGSIDE,o).includes(n)?this.update(j(s,i,b.KINGSIDE)):oe(t,b.QUEENSIDE,o).includes(n)?this.update(j(s,i,b.QUEENSIDE)):ee(t,o).includes(n)?this.update(Q(s,e)):te(t,o).includes(n)?this.update(B(this.data.board,e)):null}tryGameOver(){return this.isDraw()?g.DRAW:this.isStalemate()?g.STALEMATE:this.isWin(f.WHITE)?g.WHITE_WIN:this.isWin(f.BLACK)?g.BLACK_WIN:null}isDraw(){return this.isFiftyMoveDraw()}isWin(e){const t=C(e);return function(e,t){return $(e.board,t)&&!Z(e).length}(this.data,t)||!H(this.data.board,t)}isFiftyMoveDraw(){return this.data.halfMoves>=50}isStalemate(){return e=this.data,t=this.data.activeColor,!$(e.board,t)&&!Z(e).length&&null!=H(e.board,t);var e,t}switchTurn(){this.data.halfMoves++,this.data.activeColor==f.BLACK&&this.data.fullMoves++,this.data.activeColor=C(this.data.activeColor),this.data.enPassantTargets=[]}updateCastlingRights(e,t){if(!e)return;const{hasCastlingRights:s}=this.data,i=S[e];if(i!=v.KING){if(i==v.ROOK){const s=I[e],i={[f.BLACK]:{a8:b.QUEENSIDE,h8:b.KINGSIDE},[f.WHITE]:{a1:b.QUEENSIDE,h1:b.KINGSIDE}};t in i[s]&&(this.data.hasCastlingRights[s][i[s][t]]=!1,console.log("shit"))}}else s[I[e]]={kingside:!1,queenside:!1}}update(e){const{actions:t,result:s,moveType:i}=e,o=t.flatMap((({move:e})=>e.from!=e.to?e:[]));if(console.log(i),this.switchTurn(),i==m.DOUBLE){const{from:e,to:t}=o[0],[s,i]=E[e],n=E[t][0];this.data.enPassantTargets.push(k([(s+n)/2,i]))}const{board:n}=this.data;for(const{from:a}of o){const e=n[a];e&&(this.updateCastlingRights(e,a),S[e]==v.PAWN&&(this.data.halfMoves=0))}const r=t.flatMap((({move:e,explode:t})=>t?e.to:[]));return r.length&&(this.data.halfMoves=0,r.forEach((e=>this.updateCastlingRights(n[e],e)))),this.data.board=s,e}promote(e,t){console.log(`pawn promotion at ${e} to ${t}`),this.data.board[e]=t}}class re extends s.Scene{constructor(){super("Game"),t(this,"promotionMenus"),t(this,"gameOverMenus"),t(this,"chessLogic"),t(this,"chessGUI"),t(this,"selectedSquare"),t(this,"promotionSquare"),t(this,"isGameOver"),t(this,"pointerSquare")}create(){this.cameras.main.fadeIn(3e3,0,0,0),this.isGameOver=!1,this.chessLogic=new ne(structuredClone(w)),this.chessGUI=new D(this,he,100),this.promotionMenus={[f.WHITE]:this.createPromotionMenu(f.WHITE).setVisible(!1),[f.BLACK]:this.createPromotionMenu(f.BLACK).setVisible(!1)},this.gameOverMenus={[g.WHITE_WIN]:this.createGameOverMenu("Winner:",this.add.image(0,0,i,0).setScale(2)).setVisible(!1),[g.BLACK_WIN]:this.createGameOverMenu("Winner:",this.add.image(0,0,i,1).setScale(2)).setVisible(!1),[g.DRAW]:this.createGameOverMenu("Draw",null).setVisible(!1),[g.STALEMATE]:this.createGameOverMenu("Stalemate",null).setVisible(!1)},this.input.on("pointermove",(()=>{const{x:e,y:t}=this.input.activePointer.positionToCamera(this.cameras.main);this.pointerSquare=function(e,t,s){const{x:i,y:o}=s.worldToTileXY(e,t);return k([7-o,i])}(e,t,this.chessGUI.chessboardTilemapLayer)})),this.input.on("pointermove",(()=>{this.isGameOver||this.chessGUI.highlightSquare(this.pointerSquare)})),this.input.on("pointerdown",(()=>{if(this.isGameOver)return;const{pointerSquare:e}=this;if(!e)return void this.deselectSquare();const{activeColor:t,board:s}=this.chessLogic.data,i=s[e];if(i&&I[i]==t)return void this.selectSquare(e);if(!this.selectedSquare)return;const o=this.selectedSquare;this.deselectSquare(),this.tryMove({from:o,to:e})}))}createPromotionMenu(e){const t=this.add.container(0,0),s=this.add.graphics().fillStyle(e==f.WHITE?0:16777215,1).fillRect(-64,-16,128,32),o={[f.WHITE]:["Q","B","N","R"],[f.BLACK]:["q","b","n","r"]}[e].map(((e,s)=>this.add.image(32*(s-1.5),0,i,p[e]).setInteractive({useHandCursor:!0}).on("pointerdown",(()=>{t.visible=!1,this.chessLogic.promote(this.promotionSquare,e),this.chessGUI.promoteSprite(this.promotionSquare,e),this.tryGameOver()}))));return t.add([s,...o])}createGameOverMenu(e,t){const s=this.add.container(0,0),i=this.add.graphics().fillStyle(268435455,.75).fillRect(-64,-64,128,128),o=this.add.text(0,-32,e,{color:"black",fontFamily:"Super Dream",fontSize:24}).setResolution(32).setOrigin(.5),n=this.add.image(0,32,d).setScale(1).setOrigin(.5).setInteractive({useHandCursor:!0}).once("pointerdown",(()=>{this.cameras.main.fadeOut(1e3,0,0,0),this.time.addEvent({delay:1e3,callback:()=>this.scene.restart()})}));return s.add([i,o,t,n].flatMap((e=>e??[])))}tryMove(e){const{to:t}=e,{activeColor:s}=this.chessLogic.data,i=this.chessLogic.tryMove(e);if(console.table(i),!i)return;this.chessGUI.update(i);const{moveType:o}=i;o==m.PROMOTION&&(this.promotionSquare=t,this.promotionMenus[s].visible=!0),this.tryGameOver()}tryGameOver(){const e=this.chessLogic.tryGameOver();if(!e)return;this.isGameOver=!0;const t=this.gameOverMenus[e];t.setVisible(!0).setAlpha(0),this.tweens.add({targets:t,duration:1e3,delay:1e3,alpha:1,ease:"sine.in"})}selectSquare(e){this.selectedSquare=e,this.chessGUI.selectSquare(e),this.chessGUI.hideActionIndicators(),this.chessGUI.indicateCapturableSquares(ee(this.chessLogic.data,e)),this.chessGUI.indicateMovableSquares([...oe(this.chessLogic.data,b.KINGSIDE,e),...oe(this.chessLogic.data,b.QUEENSIDE,e),...se(this.chessLogic.data,e),...ie(this.chessLogic.data,e),...te(this.chessLogic.data,e)])}deselectSquare(){this.selectedSquare=null,this.chessGUI.deselectSquare(),this.chessGUI.highlightSquare(null),this.chessGUI.hideActionIndicators()}}function ae(e,t){const[s,i]=E[e];return t.tileToWorldXY(i,7-s)}class ce extends s.Scene{constructor(){super("Preloader")}init(){const{config:e}=this.game,t=Number(e.width),s=Number(e.height),i=.5*t,o=.5*s;this.add.rectangle(i,o,i,16).setStrokeStyle(2,16777215);const n=this.add.rectangle(i-.5*i,o,0,16,16777215);this.load.on("progress",(e=>n.width=i*e))}preload(){this.load.setPath("assets"),this.load.audio(l,h),this.load.image(n,r),this.load.image(a,c),this.load.image(d,u),this.load.spritesheet(i,o,{frameWidth:he,frameHeight:he})}create(){this.scene.start("Game")}}const le={type:Phaser.AUTO,width:192,height:192,parent:"game-container",backgroundColor:"#000000",scale:{mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH},pixelArt:!0,scene:[ce,re]};new s.Game(le);const he=16;
